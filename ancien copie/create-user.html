<!DOCTYPE html>
<html>
<head>
  <title>Super Admin Login</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #000;
      color: #0f0;
      padding: 40px;
      max-width: 800px;
      margin: 0 auto;
    }
    .box {
      border: 2px solid #0f0;
      padding: 20px;
      margin: 20px 0;
      background: #001100;
    }
    h1 {
      color: #0f0;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 3px;
    }
    .success { color: #0f0; }
    .error { color: #f00; }
    .info { color: #0ff; }
    button {
      background: #0f0;
      color: #000;
      border: none;
      padding: 10px 20px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #0ff;
    }
    input {
      background: #000;
      color: #0f0;
      border: 2px solid #0f0;
      padding: 10px;
      width: 100%;
      font-family: 'Courier New', monospace;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>OSINT System - Super Admin</h1>

  <div class="box">
    <h2>Step 1: Create Super Admin</h2>
    <p class="info">Email: admin@osint.local</p>
    <p class="info">Password: SuperAdmin2025!</p>
    <p class="info">Username: superadmin</p>
    <button onclick="createAdmin()">CREATE/UPDATE SUPER ADMIN</button>
    <div id="createResult" style="margin-top: 20px;"></div>
  </div>

  <div class="box">
    <h2>Step 2: Test Login</h2>
    <input type="email" id="email" value="admin@osint.local" placeholder="Email">
    <input type="password" id="password" value="SuperAdmin2025!" placeholder="Password">
    <button onclick="testLogin()">LOGIN</button>
    <div id="result" style="margin-top: 20px;"></div>
  </div>

  <script>
    const supabaseUrl = 'https://iogkksmlvnvptffhromj.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZ2trc21sdm52cHRmZmhyb21qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MDk3NzgsImV4cCI6MjA3NzQ4NTc3OH0.SkVUAf5JNtEMZ1Tkq4HqU_sKPEDYJvKIiqHmyChmThk';

    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function createAdmin() {
      const resultDiv = document.getElementById('createResult');
      resultDiv.innerHTML = '<p class="info">Creating/Updating Super Admin...</p>';

      try {
        const response = await fetch(`${supabaseUrl}/functions/v1/create-admin`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${supabaseKey}`,
            'Content-Type': 'application/json',
            'apikey': supabaseKey
          },
        });

        const result = await response.json();

        if (result.success) {
          resultDiv.innerHTML = '<p class="success">' + result.message + '</p>' +
            '<pre class="success">' + JSON.stringify(result.user, null, 2) + '</pre>' +
            '<p class="info">You can now login in Step 2!</p>';
        } else {
          resultDiv.innerHTML = '<p class="error">Failed: ' + result.error + '</p>';
        }
      } catch (err) {
        resultDiv.innerHTML = '<p class="error">Exception: ' + err.message + '</p>';
      }
    }

    async function testLogin() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const resultDiv = document.getElementById('result');

      resultDiv.innerHTML = '<p class="info">Logging in...</p>';

      try {
        const { data, error } = await supabase.auth.signInWithPassword({
          email: email,
          password: password
        });

        if (error) {
          resultDiv.innerHTML = '<p class="error">Login Failed: ' + error.message + '</p>';
        } else {
          resultDiv.innerHTML = '<p class="success">Login Successful!</p>' +
            '<pre class="success">' + JSON.stringify(data.user, null, 2) + '</pre>';
        }
      } catch (err) {
        resultDiv.innerHTML = '<p class="error">Exception: ' + err.message + '</p>';
      }
    }

  </script>
</body>
</html>
